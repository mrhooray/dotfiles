#!/usr/bin/env bash
DOTFILES=$HOME/.dotfiles
XDG_CONFIG_HOME=$HOME/.config

if [ ! -d $DOTFILES ]; then
    git clone https://github.com/mrhooray/dotfiles.git $DOTFILES
fi

for i in $(find $DOTFILES -mindepth 1 -maxdepth 1 ! -path '*.git' ! -path '*.gitignore' -iname '.*'); do
    target="$HOME/$(basename $i)"
    if [ -e "$target" ]; then
        echo "Skipping: $target (already exists)"
    else
        echo "Linking: $i -> $target"
        ln -sf $i "$target"
    fi
done

mkdir -p $XDG_CONFIG_HOME
for i in $(find $DOTFILES/config -mindepth 1 -maxdepth 1 -iname '*'); do
    target="$XDG_CONFIG_HOME/$(basename $i)"
    if [ -e "$target" ]; then
        echo "Skipping: $target (already exists)"
    else
        echo "Linking: $i -> $target"
        ln -sf $i "$target"
    fi
done

mkdir -p $XDG_CONFIG_HOME/opencode/agent
opencode_target="$XDG_CONFIG_HOME/opencode/AGENTS.md"
if [ -e "$opencode_target" ]; then
    echo "Skipping: $opencode_target (already exists)"
else
    echo "Linking: $DOTFILES/AGENTS.md -> $opencode_target"
    ln -sf $DOTFILES/AGENTS.md "$opencode_target"
fi

mkdir -p $HOME/.claude
claude_target="$HOME/.claude/CLAUDE.md"
if [ -e "$claude_target" ]; then
    echo "Skipping: $claude_target (already exists)"
else
    echo "Linking: $DOTFILES/AGENTS.md -> $claude_target"
    ln -sf $DOTFILES/AGENTS.md "$claude_target"
fi

mkdir -p $HOME/.codex
codex_target="$HOME/.codex/AGENTS.md"
if [ -e "$codex_target" ]; then
    echo "Skipping: $codex_target (already exists)"
else
    echo "Linking: $DOTFILES/AGENTS.md -> $codex_target"
    ln -sf $DOTFILES/AGENTS.md "$codex_target"
fi
